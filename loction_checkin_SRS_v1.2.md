# เอกสารข้อกำหนดความต้องการซอฟต์แวร์ (SRS) สำหรับ loction_checkin

## 1. บทนำ

### 1.1. วัตถุประสงค์
*พัฒนาระบบบันทึกเวลาและสถานที่ทำงานผ่าน LINE Bot โดยมีเป้าหมายหลักเพื่อป้องกันการทุจริตในการเช็คอินและส่งงาน ระบบจะควบคุมความถูกต้องของข้อมูลโดยการตรวจสอบระยะห่างจากตำแหน่งที่กำหนด และใช้เทคนิค Image Hashing เพื่อป้องกันการนำรูปภาพเก่ามาส่งซ้ำ*

### 1.2. ขอบเขต
*ระบบสามารถทำงานได้ดังนี้*
*   ผู้ใช้งานลงทะเบียนผ่าน LINE Bot
*   ผู้ใช้งานเช็คอินตำแหน่งปัจจุบันผ่านมือถือ
*   ระบบเปรียบเทียบตำแหน่งที่เช็คอินกับตำแหน่งที่กำหนดไว้ล่วงหน้า (รัศมีไม่เกิน 100 เมตร)
*   ผู้ใช้งานอัปโหลดรูปภาพ (ไม่เกิน 3 รูป) เพื่อเป็นหลักฐานหลังการเช็คอิน
*   ผู้ใช้งานสามารถ "ส่งงาน" โดยการระบุตำแหน่งและแนบรูปภาพ
*   ระบบตรวจสอบตำแหน่งการส่งงานเทียบกับสถานที่ที่กำหนด (รัศมีไม่เกิน 1 กิโลเมตร)
*   ระบบตรวจสอบภาพที่ส่งเข้ามาว่าซ้ำกับภาพที่เคยส่งในระบบแล้วหรือไม่ด้วยการทำ Hashing
*   ข้อมูลทั้งหมดจะถูกบันทึกลงใน Google Sheets

*สิ่งที่ระบบไม่ทำ*
*   ไม่มีระบบหลังบ้าน (Admin Panel) สำหรับจัดการผู้ใช้หรือตำแหน่งในเวอร์ชันนี้
*   ไม่รองรับการเช็คอิน/ส่งงานผ่านช่องทางอื่นนอกจาก LINE Bot

### 1.3. ภาพรวมของเอกสาร
*ให้ภาพรวมของโครงสร้างเอกสาร*

## 2. คำอธิบายโดยรวม

### 2.1. มุมมองและฟังก์ชันการทำงานของผลิตภัณฑ์
*อธิบายบริบทและฟังก์ชันหลักของผลิตภัณฑ์*

### 2.2. คุณลักษณะของผู้ใช้งาน
*ระบบมีผู้ใช้งาน 2 ประเภทหลัก:*
*   **พนักงาน (Employee):** ผู้ใช้งานทั่วไปที่ทำหน้าที่เช็คอินและส่งงานผ่าน LINE Bot
*   **ผู้ดูแลระบบประจำกลุ่มไซต์ (Site Group Administrator):** ผู้ใช้งานที่มีสิทธิ์ในการเรียกดูรายงานสรุปการทำงานของพนักงานในกลุ่มไซต์ที่ตนเองรับผิดชอบ

### 2.3. ข้อจำกัดและสมมติฐาน
*ระบุข้อจำกัดต่างๆ (ทางเทคนิค, กฎหมาย, ฯลฯ) และสมมติฐานที่ตั้งขึ้น*

*   **ข้อจำกัดทางเทคนิค:**
    *   ระบบจะต้องใช้ Google Sheets เป็นฐานข้อมูลหลักในการจัดเก็บและอ่านข้อมูล
    *   ระบบจะต้องใช้ Google Drive ในการจัดเก็บไฟล์ที่เกี่ยวข้อง (ถ้ามี)

## 3. ความต้องการเฉพาะ

### 3.1. ความต้องการเชิงฟังก์ชัน
*ระบุฟังก์ชันการทำงานเฉพาะที่ระบบต้องทำ สามารถระบุเป็น Use Case ได้ที่นี่*

*   **FR-001: การลงทะเบียนผู้ใช้งาน**
    *   ผู้ใช้สามารถเริ่มต้นการลงทะเบียนผ่าน LINE Bot
    *   ระบบจะร้องขอข้อมูลที่จำเป็นสำหรับการลงทะเบียน ได้แก่ ชื่อพนักงาน และตำแหน่งงาน
    *   ระบบจะดึง LINE ID ของผู้ใช้โดยอัตโนมัติ
    *   ระบบจะบันทึกข้อมูลการลงทะเบียน (LINE ID, ชื่อพนักงาน, ตำแหน่งงาน) ลงใน Google Sheets

*   **FR-002: การเช็คอิน**
    *   ผู้ใช้สามารถส่งตำแหน่งปัจจุบัน (Current Location) ผ่าน LINE Bot เพื่อทำการเช็คอิน
    *   ระบบจะนำตำแหน่งของผู้ใช้ไปค้นหาใน Sheet "Locations" ทั้งหมดเพื่อหาสถานที่ที่ใกล้ที่สุดและอยู่ในรัศมีการเช็คอิน
    *   หากพบ ระบบจะบันทึกการเช็คอินพร้อมระบุ "ชื่อสถานที่" และ "กลุ่มไซต์งาน (site_group)" ที่เช็คอินลงใน Sheet "CheckIns"
    *   หากไม่พบสถานที่ที่ตรงเงื่อนไขในรัศมี ระบบจะแจ้งเตือนและไม่อนุญาตให้เช็คอิน

*   **FR-003: การอัปโหลดรูปภาพหลังเช็คอิน**
    *   หลังจากเช็คอินสำเร็จ ระบบจะร้องขอให้ผู้ใช้อัปโหลดรูปภาพเพื่อเป็นหลักฐาน
    *   ผู้ใช้สามารถอัปโหลดรูปภาพได้สูงสุด 3 ภาพ
    *   ระบบจะบันทึก URL ของรูปภาพเชื่อมโยงกับข้อมูลการเช็คอินใน Google Sheets

*   **FR-004: การส่งงาน**
    *   ผู้ใช้สามารถเริ่มต้นกระบวนการ "ส่งงาน" ผ่าน LINE Bot และส่งตำแหน่งปัจจุบัน
    *   ระบบจะนำตำแหน่งของผู้ใช้ไปค้นหาใน Sheet "Locations" ทั้งหมดเพื่อหาสถานที่ที่ใกล้ที่สุดและอยู่ในรัศมีการส่งงาน
    *   หากพบ ระบบจะยืนยัน "ชื่อสถานที่" และ "กลุ่มไซต์งาน (site_group)" และร้องขอให้ผู้ใช้อัปโหลดรูปภาพประกอบการส่งงาน (สูงสุด 3 ภาพ)
    *   หลังจากได้รับภาพ ระบบจะเริ่มกระบวนการตรวจสอบใน FR-005 และ FR-006 โดยใช้บริบทของสถานที่และกลุ่มไซต์งานที่เพิ่งค้นพบ
    *   หากไม่พบสถานที่ที่ตรงเงื่อนไขในรัศมี ระบบจะแจ้งเตือนผู้ใช้

*   **FR-005: การคำนวณและตรวจสอบภาพซ้ำ**
    *   สำหรับแต่ละภาพที่ส่งเข้ามา ระบบจะคำนวณค่า Hash ของภาพ
    *   ระบบจะนำค่า Hash ไปเปรียบเทียบกับค่า Hash ของรูปภาพทั้งหมดที่เคยมีการส่งงานใน Sheet "WorkSubmissions"
    *   ผลการตรวจสอบ (ซ้ำหรือไม่, ซ้ำกับภาพใด) จะถูกนำไปใช้ใน FR-006

*   **FR-006: การตรวจสอบและบันทึกสถานะงาน**
    *   ระบบจะดึงข้อมูลการเช็คอินล่าสุดในวันเดียวกันของผู้ใช้จาก Sheet "CheckIns"
    *   **เงื่อนไขที่ 1:** ตรวจสอบว่า "ชื่อสถานที่" ของการเช็คอินตรงกับ "ชื่อสถานที่" ของการส่งงานหรือไม่
    *   **เงื่อนไขที่ 2:** ตรวจสอบว่ารูปภาพที่ส่งมาซ้ำกับรูปภาพเก่าในระบบหรือไม่ (จากผลลัพธ์ของ FR-005)
    *   ระบบจะบันทึกข้อมูลการส่งงานทั้งหมดลงใน Sheet "WorkSubmissions" พร้อมกำหนดค่า "สถานะ" และ "หมายเหตุ" ดังนี้:
        *   **สถานะ 'pass':** เมื่อผ่านทั้ง 2 เงื่อนไข
        *   **สถานะ 'notpass':** เมื่อไม่ผ่านเงื่อนไขใดเงื่อนไขหนึ่ง
        *   **หมายเหตุ:** หากเป็น 'notpass' ให้ระบุสาเหตุ เช่น "ตำแหน่งส่งงานไม่ตรงกับที่เช็คอิน", "ภาพที่ 1 ซ้ำกับงานรหัส #123", หรือทั้งสองอย่าง

*   **FR-007: การสร้างรายงานตรวจสอบการส่งงาน (สำหรับ Admin)**
    *   ผู้ใช้ที่มีสิทธิ์เป็น Admin สามารถเรียกใช้คำสั่งพิเศษ (เช่น /report) ผ่าน LINE Bot
    *   ระบบจะตรวจสอบสิทธิ์โดยการนำ `line_id` ของผู้ใช้ไปค้นหาใน Sheet "AdminPermissions"
    *   หากไม่พบสิทธิ์ ระบบจะแจ้งว่าผู้ใช้ไม่มีสิทธิ์
    *   หากพบสิทธิ์ และ Admin ดูแลหลายกลุ่มไซต์ ระบบจะให้ผู้ใช้เลือกกลุ่มที่ต้องการดูรายงาน
    *   ระบบจะถามวันที่ที่ต้องการตรวจสอบ (Default เป็นวันปัจจุบัน)
    *   ระบบจะทำการเปรียบเทียบข้อมูลจาก Sheet "CheckIns" และ "WorkSubmissions" โดยกรองข้อมูลเฉพาะกลุ่มไซต์ที่ Admin เลือก
    *   ระบบจะคัดกรองรายชื่อพนักงานที่ "เช็คอิน" แต่ "ไม่ส่งงาน" ในวันและกลุ่มไซต์ดังกล่าว
    *   ระบบจะส่งข้อความสรุปผลกลับไปให้ Admin ทาง LINE

### 3.2. ความต้องการที่ไม่ใช่เชิงฟังก์ชัน
*ระบุความต้องการที่ไม่เกี่ยวข้องกับฟังก์ชันการทำงานโดยตรง*
*ตัวอย่าง: ประสิทธิภาพ, ความปลอดภัย, ความง่ายในการใช้งาน, ความน่าเชื่อถือ, ฯลฯ*

## 4. ภาคผนวก
*(ถ้ามี) ใส่ข้อมูลเพิ่มเติม เช่น อภิธานศัพท์, แบบจำลองข้อมูล, ฯลฯ*

### 4.1 โครงสร้างข้อมูล Google Sheets

*   **Sheet: Employees** (สำหรับเก็บข้อมูลพนักงาน)
    *   `line_id` (Text): ไอดี LINE ของผู้ใช้ (Primary Key)
    *   `employee_name` (Text): ชื่อ-สกุลของพนักงาน
    *   `position` (Text): ตำแหน่งงาน

*   **Sheet: CheckIns** (สำหรับเก็บข้อมูลการเช็คอิน)
    *   `checkin_id` (Text): รหัสอ้างอิงการเช็คอิน (Primary Key)
    *   `timestamp` (Timestamp): วันที่และเวลาที่เช็คอิน
    *   `line_id` (Text): ไอดี LINE ของผู้ที่เช็คอิน
    *   `location_name` (Text): ชื่อสถานที่ที่เช็คอิน
    *   `site_group` (Text): กลุ่มของสถานที่ที่เช็คอิน
    *   `image_url_1` (Text): URL ของรูปภาพที่ 1 ใน Google Drive
    *   `image_url_2` (Text): URL ของรูปภาพที่ 2 ใน Google Drive
    *   `image_url_3` (Text): URL ของรูปภาพที่ 3 ใน Google Drive

*   **Sheet: Locations** (สำหรับเก็บข้อมูลตำแหน่งที่ตั้งเป้าหมาย)
    *   `location_name` (Text): ชื่อสถานที่ (Primary Key)
    *   `site_group` (Text): กลุ่มของสถานที่ (เช่น กรุงเทพ, ปริมณฑล)
    *   `latitude` (Number): ค่าละติจูดของสถานที่
    *   `longitude` (Number): ค่าลองจิจูดของสถานที่
    *   `checkin_radius_meters` (Number): รัศมีที่อนุญาตให้ "เช็คอิน" (หน่วยเป็นเมตร)
    *   `submission_radius_meters` (Number): รัศมีที่อนุญาตให้ "ส่งงาน" (หน่วยเป็นเมตร)

*   **Sheet: WorkSubmissions** (สำหรับเก็บข้อมูลการส่งงาน)
    *   `submission_id` (Text): รหัสอ้างอิงการส่งงาน (Primary Key)
    *   `submission_timestamp` (Timestamp): วันที่และเวลาที่ส่งงาน
    *   `line_id` (Text): ไอดี LINE ของผู้ที่ส่งงาน
    *   `location_name` (Text): ชื่อสถานที่ที่ส่งงาน
    *   `site_group` (Text): กลุ่มของสถานที่ที่ส่งงาน
    *   `image_url_1` (Text): URL ของรูปภาพที่ 1
    *   `image_hash_1` (Text): ค่า Hash ของรูปภาพที่ 1
    *   `duplicate_of_1` (Text): รหัส `submission_id` ของงานที่ภาพที่ 1 ซ้ำด้วย (ถ้ามี)
    *   `image_url_2` (Text): URL ของรูปภาพที่ 2
    *   `image_hash_2` (Text): ค่า Hash ของรูปภาพที่ 2
    *   `duplicate_of_2` (Text): รหัส `submission_id` ของงานที่ภาพที่ 2 ซ้ำด้วย (ถ้ามี)
    *   `image_url_3` (Text): URL ของรูปภาพที่ 3
    *   `image_hash_3` (Text): ค่า Hash ของรูปภาพที่ 3
    *   `duplicate_of_3` (Text): รหัส `submission_id` ของงานที่ภาพที่ 3 ซ้ำด้วย (ถ้ามี)
    *   `status` (Text): สถานะของงาน (pass / notpass)
    *   `remarks` (Text): หมายเหตุ (ระบุสาเหตุหากเป็น notpass)

*   **Sheet: AdminPermissions** (สำหรับจัดการสิทธิ์ผู้ดูแล)
    *   `line_id` (Text): ไอดี LINE ของผู้ที่ได้รับสิทธิ์เป็น Admin
    *   `managed_site_group` (Text): กลุ่มไซต์ที่ Admin คนนั้นดูแล

### 4.2 ข้อมูลการตั้งค่าระบบเบื้องต้น
*   **Service Account Email:** `senacheckin@checkin-468306.iam.gserviceaccount.com`